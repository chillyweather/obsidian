# Registration

## 1. Register.js

```jsx
// Register.js

import React, { Button } from "react";
import { Link } from "react-router-dom";
import Logo from "./Logo.js";
import "./styles/Register.css";

class Register extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      username: "",
      email: "",
      password: "",
      confirmPassword: "",
    };
    this.handleChange = this.handleChange.bind(this);
    this.handleSubmit = this.handleSubmit.bind(this);
  }
  handleChange(e) {
    const { name, value } = e.target;
    this.setState({
      [name]: value,
    });
  }
  handleSubmit() {
    if (this.state.password === this.state.confirmPassword) {
      // we need to handle registration here!
    }
  }
  render() {
    return (
      <div className="register">
        <Logo title={"CryptoDucks"} />
        <p className="register__welcome">Please register.</p>
        <form className="register__form">
          <label>Username:</label>
          <input
            name="username"
            type="text"
            value={this.state.username}
            onChange={this.handleChange}
          />
          <label>Email:</label>
          <input
            name="email"
            type="email"
            value={this.state.email}
            onChange={this.handleChange}
          />
          <label>Password:</label>
          <input
            name="password"
            type="password"
            value={this.state.password}
            onChange={this.handleChange}
          />
          <label>Confirm password:</label>
          <input
            name="confirmPassword"
            type="password"
            value={this.state.confirmPassword}
            onChange={this.handleChange}
          />
        </form>
        <div className="register__button-container">
          <button onClick={this.handleSubmit} className="register__link">
            Sign up
          </button>
        </div>
        <div className="register__signin">
          <p>Already a member?</p>
          <Link to="login" className="register__login-link">
            Log in here
          </Link>
        </div>
      </div>
    );
  }
}

export default Register;
```

## 2. Auth.js

```jsx
// auth.js

export const BASE_URL = "https://api.nomoreparties.co";

export const register = (username, password, email) => {
  return fetch(`${BASE_URL}/auth/local/register`, {
    method: "POST",
    headers: {
      Accept: "application/json",
      "Content-Type": "application/json",
    },
    body: JSON.stringify({ username, password, email }),
  })
    .then((response) => {
      try {
        if (response.status === 200) {
          return response.json();
        }
      } catch (e) {
        return e;
      }
    })
    .catch((err) => console.log(err));
};
```

This function will take three arguments: `username`, `password`, and `email`. It will make a `POST` request using `fetch()`.

Then, in the first `then()` handler, we'll get back a `response` object with information about the request itself, including the `status` of the request. If all is well and we get a status of `200`, the second `then()` handler will return an object (which we named `res`) with more information. This will include the data we just submitted about the user, a reference to the URL where we made the request, and a unique and signed JWT.

Now, we just need to import the `auth.js` file inside of `Register.js`. We'll do that like this: `import * as auth from '../auth.js';`.

Next, we'll update our `handleSubmit()` handler to include our new function:

```jsx
// Register.js

handleSubmit(e) {
    e.preventDefault();
  if (this.state.password === this.state.confirmPassword) {
    const { username, password, email } = this.state;
    auth.register(username, password, email);
  }
}
```

## The `withRouter` HOC

`Register` is a class component, so we won't be able to use hooks inside of it. In order to gain access to the `history` object and redirect the user to the login screen, we'll use a third-party HOC component from the React Router library: `withRouter`.

[The `withRouter` HOC](https://reactrouter.com/web/api/withRouter) provides the `history`, `location`, and `match` objects generated by React Router to your component, as props. [The `history` object](https://reactrouter.com/web/api/history) allows you not just to redirect the user, but also to do things like simulate a browser "back" click, and view certain information about the user's navigation history on your page. The [`location`](https://reactrouter.com/web/api/location) and [`match` objects](https://reactrouter.com/web/api/match) give you extra information about the current URL and the current `Route` that was matched.

In a functional component, you access these same objects using [hooks such as `useHistory`](https://reactrouter.com/web/api/Hooks/usehistory).

For this component, we'll just be using the `history` prop and ignoring the other two.

First, let's import this component into `Register.js` by adding it to our list of imports, like so:

```jsx
// Register.js

import { Link, withRouter } from 'react-router-dom';
```

Then, at the bottom of the file, we just need to modify our `export` statement a bit:

```jsx
// the final line of Register.js has been changed

export default withRouter(Register);
```

With this, we've now ensured that the `Register` component has been wrapped by the HOC component. Now, our component will have access to the `history` object inside of `props`. This `history` object allows us to use the `push()` method, and we can pass the path to which we want to redirect the user as an argument, which in our case, is `'/login'`.

Let's chain on another `then()` handler to our `handleSubmit()` method. We only want to redirect users after the registration form has been properly submitted. Now it looks like this:

```jsx
// Register.js

handleSubmit(e) {
  e.preventDefault();
  if (this.state.password === this.state.confirmPassword) {
    let { username, password, email } = this.state;
    auth.register(username, password, email).then((res) => {
      if (res) {
        this.setState({ message: "" }, () => {
          this.props.history.push("/login");
        });
      } else {
        this.setState({
          message: "Something went wrong!",
        });
      }
    });
  }
}
```

If we get a response from `register()`, we redirect our users to the `Login` component.